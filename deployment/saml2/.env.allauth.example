# =============================================================================
# Django-Allauth SAML2 SSO Configuration
# =============================================================================
# This file configures SAML2 authentication using Django-allauth framework.
# Allauth provides a flexible authentication system with support for multiple
# social/enterprise providers and multi-factor authentication (MFA).
#
# Setup workflow:
# 1. Configure your identity provider (IdP) to trust this service provider (SP)
# 2. Obtain the IdP metadata URL and entity ID
# 3. Update the settings below to match your IdP configuration
# 4. Configure attribute mappings for user profile fields
# 5. Configure security settings (signing, encryption)
# 6. Test authentication flow
# =============================================================================

# =============================================================================
# Core Authentication Settings
# =============================================================================

# Enable Django-allauth authentication framework
# Set to True to use allauth for authentication (supports local + SSO)
# Set to False to use Django's default authentication only
ENABLE_ALLAUTH=True

# Enable local multi-factor authentication (MFA)
# Set to True to allow users to set up MFA (TOTP, backup codes, etc.)
# Set to False to disable MFA features
# NOTE: This is for local accounts, not SAML accounts (MFA is handled by IdP)
ENABLE_ALLAUTH_LOCAL_MFA=True

# Enable SAML2 SSO authentication
# Set to True to allow users to log in via SAML identity provider
# Set to False to disable SAML (only local username/password login)
ENABLE_SAML2_SSO_AUTH=True

# =============================================================================
# Identity Provider (IdP) Configuration
# =============================================================================

# IdP metadata URL - Where to fetch IdP configuration
# Examples:
#   Keycloak: https://keycloak.example.com/auth/realms/your-realm/protocol/saml/descriptor
#   Okta: https://your-org.okta.com/app/abc123xyz/sso/saml/metadata
#   Azure AD: https://login.microsoftonline.com/your-tenant-id/federationmetadata/2007-06/federationmetadata.xml
SAML_IDP_METADATA_URL=http://localhost:8080/auth/realms/cdcs-realm/protocol/saml/descriptor

# IdP entity ID - Unique identifier for your identity provider
# This must match the entityID in your IdP's metadata
# Usually the same as the base URL of your IdP realm/tenant
SAML_IDP_ENTITY_ID=http://localhost:8080/auth/realms/cdcs-realm

# =============================================================================
# Service Provider (SP) Configuration
# =============================================================================

# Client/Application ID configured in your IdP
# This is the identifier your IdP uses to recognize this application
# Must match the client ID configured in your IdP
SAML_CLIENT_ID=cdcs

# Human-readable name for this SAML provider (shown to users)
# Displayed on the login page as "Sign in with [PROVIDER_NAME]"
SAML_PROVIDER_NAME=Test Keycloak

# Internal identifier for this provider (used in URLs and database)
# Use lowercase, no spaces (e.g., "keycloak", "okta", "azure-ad")
SAML_PROVIDER_ID=keycloak

# =============================================================================
# Email Authentication Settings
# =============================================================================
# These settings control how SAML accounts are linked to existing local accounts

# Allow SAML login to authenticate existing users by email match
# Set to True to link SAML accounts to existing local accounts with same email
# Set to False to require separate SAML account creation
# SECURITY NOTE: Only enable if you trust your IdP to verify email addresses
#SAML_EMAIL_AUTHENTICATION=True

# Trust email addresses from IdP as verified
# Set to True to mark emails from SAML as verified (skip email confirmation)
# Set to False to require email verification even for SAML users
# SECURITY NOTE: Only enable if your IdP properly verifies email ownership
#SAML_VERIFIED_EMAIL=True

# =============================================================================
# Attribute Mapping Configuration
# =============================================================================
# Maps SAML attributes from your IdP to Django user fields

# Simple field names (if your IdP uses basic attribute format)
SAML_ATTRIBUTES_MAP_UID_FIELD=uid          # Unique user identifier
SAML_ATTRIBUTES_MAP_EMAIL_FIELD=mail       # Email address
SAML_ATTRIBUTES_MAP_CN_FIELD=cn            # Common name (first name)
SAML_ATTRIBUTES_MAP_SN_FIELD=sn            # Surname (last name)

# OID/URN identifiers (if your IdP uses OID attribute format)
SAML_ATTRIBUTES_MAP_UID=urn:oid:0.9.2342.19200300.100.1.1      # uid
SAML_ATTRIBUTES_MAP_EMAIL=urn:oid:1.2.840.113549.1.9.1         # emailAddress
SAML_ATTRIBUTES_MAP_CN=urn:oid:2.5.4.42                        # givenName
SAML_ATTRIBUTES_MAP_SN=urn:oid:2.5.4.4                         # surname

# =============================================================================
# SAML Protocol Settings
# =============================================================================

# Allow attributes with the same name to appear multiple times
# Set to True if your IdP sends multi-valued attributes
SAML_ALLOW_REPEAT_ATTRIBUTE_NAME=True

# Allow single-label domains (e.g., http://localhost instead of http://localhost.domain)
# Set to True for development environments
# Set to False for production (recommended for security)
SAML_ALLOW_SINGLE_LABEL_DOMAINS=False

# =============================================================================
# Request Signing and Encryption Settings
# =============================================================================
# These control security features for SAML messages

# Sign authentication requests sent to IdP
# Set to True if your IdP requires signed requests (more secure)
# Set to False if your IdP doesn't validate signatures
SAML_AUTHN_REQUEST_SIGNED=False

# Cryptographic digest algorithm for signatures
# Modern standard: http://www.w3.org/2001/04/xmldsig-more#rsa-sha256
# Legacy: http://www.w3.org/2000/09/xmldsig#sha1 (NOT RECOMMENDED)
SAML_DIGEST_ALGORITHM=http://www.w3.org/2001/04/xmldsig-more#rsa-sha256

# Sign logout requests sent to IdP
# Set to True for more secure logout flow
SAML_LOGOUT_REQUEST_SIGNED=False

# Sign logout responses sent to IdP
# Set to True for more secure logout flow
SAML_LOGOUT_RESPONSE_SIGNED=False

# Sign this SP's metadata XML
# Set to True if your IdP validates metadata signatures
SAML_METADATA_SIGNED=False

# Encrypt NameID in requests
# Set to True if your IdP supports and requires NameID encryption
SAML_NAME_ID_ENCRYPTED=False

# NameID format to request from IdP
# Common formats:
#   urn:oasis:names:tc:SAML:1.1:nameid-format:unspecified (most flexible)
#   urn:oasis:names:tc:SAML:1.1:nameid-format:emailAddress (use email as ID)
#   urn:oasis:names:tc:SAML:2.0:nameid-format:persistent (stable user identifier)
SAML_NAME_ID_FORMAT=urn:oasis:names:tc:SAML:1.1:nameid-format:unspecified

# Reject SAML messages using deprecated cryptographic algorithms
# Set to True to enforce modern security standards (RECOMMENDED)
# Set to False only if your IdP uses legacy algorithms
SAML_REJECT_DEPRECATED_ALGORITHM=True

# Reject IdP-initiated SSO (unsolicited SAML responses)
# Set to True to only allow SP-initiated login (more secure, prevents CSRF)
# Set to False to allow IdP-initiated login (less secure, convenient for some users)
SAML_REJECT_IDP_INITIATED_SSO=True

# Signature algorithm for signing requests
# Modern standard: http://www.w3.org/2001/04/xmldsig-more#rsa-sha256
SAML_SIGNATURE_ALGORITHM=http://www.w3.org/2001/04/xmldsig-more#rsa-sha256

# =============================================================================
# Response Validation Requirements
# =============================================================================
# These control what the SP requires/expects from IdP responses

# Require assertions to be encrypted
# Set to True if you need encrypted assertions (high security environments)
# Set to False for most standard deployments
SAML_WANT_ASSERTION_ENCRYPTED=False

# Require assertions to be signed
# Set to True to validate assertion signatures (RECOMMENDED for security)
# Set to False only if your IdP doesn't sign assertions
SAML_WANT_ASSERTION_SIGNED=False

# Require attribute statement in assertions
# Set to True to ensure user attributes are included
SAML_WANT_ATTRIBUTE_STATEMENT=True

# Require SAML messages to be signed
# Set to True to validate message signatures (RECOMMENDED for security)
SAML_WANT_MESSAGE_SIGNED=False

# Require NameID in assertions
# Set to True if you need NameID for user identification
# Set to False if using attributes only
SAML_WANT_NAME_ID=False

# Require NameID to be encrypted
# Set to True for high security environments
SAML_WANT_NAME_ID_ENCRYPTED=False

# =============================================================================
# Service Provider Certificates
# =============================================================================
# Private key and certificate for signing/encryption
# Generate with: openssl req -new -x509 -days 3652 -nodes -out cert.pem -keyout key.pem

# Private key for signing and decryption (paths relative to saml2/ directory)
# SECURITY: Keep this file secure! Never commit to version control!
#SAML_PRIVATE_KEY=key.pem

# Public certificate for verification and encryption (share with IdP)
#SAML_X509CERT=cert.pem

# =============================================================================
# Service Provider Contact Information
# =============================================================================
# Contact persons for technical and administrative support
# Format: Firstname,Lastname,Organization,Email,Type
# Types: technical, administrative, support, billing, other

CONTACT_PERSON_1=Firstname1,Lastname1,Example Co.,contact1@example.com,technical
CONTACT_PERSON_2=Firstname2,Lastname2,Example Co.,contact2@example.com,administrative
