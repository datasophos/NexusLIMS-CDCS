# ============================================================================
# NexusLIMS-CDCS Production Environment Template
# ============================================================================
# Copy to .env and customize for your environment
# For development: Use .env.dev as starting point
# For production: Use this .env.prod.example and customize
# NEVER commit .env to git!

# ----------------------------------------------------------------------------
# File Serving Configuration
# ----------------------------------------------------------------------------
# Host paths for production file serving
#
# NX_DATA_HOST_PATH should point to the read/write NexusLIMS metadata path
# (for preview images, logs, json files, etc.)
#
# NX_INSTRUMENT_DATA_HOST_PATH should point to the read-only folder where
# the actual raw experimental instrument data files are stored
#
# Both of these can be either local files, or network-mounted locations
NX_DATA_HOST_PATH=/mnt/nexuslims/data
NX_INSTRUMENT_DATA_HOST_PATH=/mnt/nexuslims/instrument-data

# ----------------------------------------------------------------------------
# API Credentials
# ----------------------------------------------------------------------------
# Admin API token for authenticating with the CDCS REST API
# This token will be automatically created/updated for the admin user during
# environment initialization (see deployment/scripts/init_environment.py)
#
# This value will need to match the NX_CDCS_TOKEN setting on the NexusLIMS
# backend.
#
# Use the following command to generate a random secure token (max 40 characters):
# python3 -c "from secrets import token_urlsafe; print(token_urlsafe(30))"
#
# Leave empty to skip automatic token creation (you can create tokens manually
# via Django admin panel)
NX_ADMIN_API_TOKEN=

# ----------------------------------------------------------------------------
# Project Identification
# ----------------------------------------------------------------------------
COMPOSE_PROJECT_NAME=nexuslims_prod

# Docker image version tag - use semantic versioning for production deployments
# This helps track which version is deployed and enables rollbacks
IMAGE_VERSION=3.18.0

# ----------------------------------------------------------------------------
# Application URLs & Domains
# ----------------------------------------------------------------------------
# Development: Use .localhost domains (no DNS needed)
# Production: Use your actual domains
DOMAIN=nexuslims.example.com
FILES_DOMAIN=files.nexuslims.example.com

# Derived URLs (usually don't need to change these)
SERVER_URI=https://${DOMAIN}
ALLOWED_HOSTS=${DOMAIN}
CSRF_TRUSTED_ORIGINS=https://${DOMAIN}

# ----------------------------------------------------------------------------
# Django Configuration
# ----------------------------------------------------------------------------
# change this to "custom_settings" if you'd like to override the default
# configuration provided in the /config folder:
# DJANGO_SETTINGS_MODULE=config.settings.custom_settings
DJANGO_SETTINGS_MODULE=config.settings.prod_settings

# Use the following command to generate a random secret key:
# python3 -c "from secrets import token_urlsafe; print(token_urlsafe(50))"
DJANGO_SECRET_KEY=CHANGE_THIS_TO_A_RANDOM_SECRET_KEY
DJANGO_DEBUG=False

# ----------------------------------------------------------------------------
# Database Configuration
# ----------------------------------------------------------------------------
POSTGRES_VERSION=17
POSTGRES_DB=nexuslims
POSTGRES_USER=nexuslims
# Use the following command to generate a random password:
# python3 -c "from secrets import token_urlsafe; print(token_urlsafe(32))"
POSTGRES_PASS=CHANGE_THIS_SECURE_PASSWORD
POSTGRES_HOST=postgres
POSTGRES_PORT=5432
POSTGRES_HOST_PORT=5532

# ----------------------------------------------------------------------------
# Redis Configuration
# ----------------------------------------------------------------------------
REDIS_VERSION=8
# Use the following command to generate a random password:
# python3 -c "from secrets import token_urlsafe; print(token_urlsafe(32))"
REDIS_PASS=CHANGE_THIS_SECURE_PASSWORD
REDIS_HOST=redis
REDIS_PORT=6379
REDIS_HOST_PORT=6479

# ----------------------------------------------------------------------------
# Caddy Configuration
# ----------------------------------------------------------------------------
# Which Caddyfile to use
CADDYFILE=Caddyfile.prod
CADDY_ACME_EMAIL=admin@example.com

# Custom TLS Certificates (OPTIONAL)
# -----------------------------------
# Leave commented/unset to use automatic ACME (Let's Encrypt) certificates
# Set to a directory path to use custom certificates (e.g., for local testing with mkcert)
#
# When set, Caddy will:
#   1. Mount certificates from this host directory
#   2. Automatically enable the tls directive in Caddyfile
#   3. Use your custom fullchain.pem and privkey.pem files
#
# Required files in directory (standard naming):
#   - fullchain.pem (certificate + chain)
#   - privkey.pem (private key)
#
# Example for local testing (uncomment this if following local testing deployment guide):
# CADDY_CERTS_HOST_PATH=/opt/nexuslims/local-certs
#
# Leave unset or commented for production (uses automatic ACME):
# CADDY_CERTS_HOST_PATH=

# ----------------------------------------------------------------------------
# Backup Configuration
# ----------------------------------------------------------------------------
# Timezone for backup timestamps (IANA timezone database name)
# Examples: America/New_York, America/Los_Angeles, UTC, Europe/London
# Default: America/New_York
TZ=America/New_York

# The path on the host that will be used by the admin-commands.sh backup tools
# Note, this directory must be owned by the user running Docker (on MacOS, at least)
NX_CDCS_BACKUPS_HOST_PATH=/opt/nexuslims/backups

# ----------------------------------------------------------------------------
# File Serving Configuration
# ----------------------------------------------------------------------------
# Paths for data files inside the containers (this shouldn't need to be changed)
NX_DATA_PATH=/srv/nx-data
NX_INSTRUMENT_DATA_PATH=/srv/nx-instrument-data

# ----------------------------------------------------------------------------
# XSLT Configuration
# ----------------------------------------------------------------------------
# Base URLs used when patching XSLT stylesheets
# These should match your FILES_DOMAIN configuration; the paths (/instrument-data and /data)
# match those used by the default caddy file server included in this config
XSLT_DATASET_BASE_URL=https://${FILES_DOMAIN}/instrument-data
XSLT_PREVIEW_BASE_URL=https://${FILES_DOMAIN}/data

# ----------------------------------------------------------------------------
# Gunicorn Configuration for production Django server (Performance Tuning)
# ----------------------------------------------------------------------------
# Workers: Number of worker processes (rule of thumb: 2-4 × CPU_CORES)
# Threads: Number of threads per worker (2-4 is typical)
# Timeout: Request timeout in seconds (increase for long-running operations)
#
# Recommended configurations by server size:
#   Small (2-4 cores, 4-8 GB RAM):  WORKERS=4,  THREADS=2
#   Medium (4-8 cores, 8-16 GB RAM): WORKERS=8,  THREADS=2
#   Large (8+ cores, 16+ GB RAM):    WORKERS=12, THREADS=4
#
# Note: Total concurrent requests ≈ WORKERS × THREADS
GUNICORN_WORKERS=4
GUNICORN_THREADS=2
GUNICORN_TIMEOUT=120
